<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>FFT&amp;NTT | Bambusoideae&#39;s Blog</title>
    <meta name="description" content="FFT and NTT">
    <meta name="baidu-site-verification" content="ZkBG5vw3Wv">
  <link rel="icon" href="/favicon.ico">
  <link rel="manifest" href="/manifest.json">
  <link rel="apple-touch-icon" href="/favicon.ico">
  <link rel="stylesheet" href="//unpkg.com/gitalk/dist/gitalk.css">
  <link rel="stylesheet" href="//cdnjs.loli.net/ajax/libs/mdui/0.4.3/css/mdui.min.css">
  <script src="//code.jquery.com/jquery-3.4.1.min.js"></script>
  <script src="//cdnjs.loli.net/ajax/libs/mdui/0.4.3/js/mdui.min.js"></script>
  <script src="//cdn.bootcss.com/blueimp-md5/2.10.0/js/md5.min.js"></script>
  <script src="//unpkg.com/gitalk/dist/gitalk.min.js"></script>
  <script src="/global.js"></script>
  <script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?a04f74e26e451964b94a7461c1ed6d0d";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script>
    
    <link rel="preload" href="/assets/css/0.styles.69119079.css" as="style"><link rel="preload" href="/assets/js/app.2b333f8b.js" as="script"><link rel="preload" href="/assets/js/4.45ca7a6b.js" as="script"><link rel="preload" href="/assets/js/13.2225d7d0.js" as="script"><link rel="prefetch" href="/assets/js/1.b87ca925.js"><link rel="prefetch" href="/assets/js/10.85d6185b.js"><link rel="prefetch" href="/assets/js/11.1f961928.js"><link rel="prefetch" href="/assets/js/12.b8be9a05.js"><link rel="prefetch" href="/assets/js/14.0cca985a.js"><link rel="prefetch" href="/assets/js/15.28d69290.js"><link rel="prefetch" href="/assets/js/16.cc7abd41.js"><link rel="prefetch" href="/assets/js/17.ad986cb3.js"><link rel="prefetch" href="/assets/js/18.8737e395.js"><link rel="prefetch" href="/assets/js/19.76cf65ff.js"><link rel="prefetch" href="/assets/js/20.b24fb7c3.js"><link rel="prefetch" href="/assets/js/21.d43cfbb3.js"><link rel="prefetch" href="/assets/js/3.f3af57b6.js"><link rel="prefetch" href="/assets/js/5.e88c89a9.js"><link rel="prefetch" href="/assets/js/6.fed09016.js"><link rel="prefetch" href="/assets/js/7.2a5eb01d.js"><link rel="prefetch" href="/assets/js/8.c43eb433.js"><link rel="prefetch" href="/assets/js/9.2686a4a4.js">
    <link rel="stylesheet" href="/assets/css/0.styles.69119079.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="mb-post" class="mdui-bottom-nav-fixed"><div id="mb-nav" class="mdui-drawer mdui-drawer-opened mdui-color-white"><div mdui-collapse="{accordion: true}" class="mdui-list mdui-collapse"><div class="mdui-collapse-item mdui-collapse-item-open"><div class="mdui-collapse-item-header mdui-list-item mdui-ripple"><i class="mdui-list-item-icon mdui-icon material-icons"></i> <div class="mdui-list-item-content">Links</div> <i class="mdui-collapse-item-arrow mdui-icon material-icons"></i></div> <!----><div class="mdui-collapse-item-body mdui-list"><div class="mdui-divider"></div> <a href="https://www.luogu.org/" target="_blank" class="mdui-list-item mdui-ripple"><div class="mdui-list-item-content">洛谷</div></a><a href="https://opensouls.github.io/" target="_blank" class="mdui-list-item mdui-ripple"><div class="mdui-list-item-content">opensouls的博客</div></a><a href="https://keepthethink.github.io/" target="_blank" class="mdui-list-item mdui-ripple"><div class="mdui-list-item-content">Helium的博客</div></a><a href="https://2759942374.github.io/" target="_blank" class="mdui-list-item mdui-ripple"><div class="mdui-list-item-content">F Zx的博客</div></a> <div class="mdui-divider"></div></div><!----><!----><!----><!----><!----><!----><!----><!----></div> <div class="mdui-collapse-item"><div class="mdui-collapse-item-header mdui-list-item mdui-ripple"><i class="mdui-list-item-icon mdui-icon material-icons"></i> <div class="mdui-list-item-content">Tags</div> <i class="mdui-collapse-item-arrow mdui-icon material-icons"></i></div> <div mdui-collapse="{accordion: true}" class="mdui-collapse-item-body mdui-list mdui-collapse"><div class="mdui-divider"></div>  <div class="mdui-divider"></div></div></div></div> <script>(function() {document.getElementsByTagName(&quot;body&quot;)[0].className+=' mdui-drawer-body-left';})();</script></div> <div class="mdui-appbar"><div class="mdui-toolbar mdui-color-indigo"><button onclick="showNav()" class="mdui-btn mdui-btn-icon"><i class="mdui-icon material-icons">menu</i></button> <div class="mdui-typo-title">FFT&amp;NTT</div> <div class="mdui-toolbar-spacer"></div> <a href="https://github.com/Bambusaceae" target="_blank" class="mdui-btn mdui-btn-icon"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="Layer_1" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve" class="mdui-icon"><path fill-rule="evenodd" clip-rule="evenodd" fill="#ffffff" d="M16,0.4c-8.8,0-16,7.2-16,16c0,7.1,4.6,13.1,10.9,15.2  c0.8,0.1,1.1-0.3,1.1-0.8c0-0.4,0-1.4,0-2.7c-4.5,1-5.4-2.1-5.4-2.1c-0.7-1.8-1.8-2.3-1.8-2.3c-1.5-1,0.1-1,0.1-1  c1.6,0.1,2.5,1.6,2.5,1.6c1.4,2.4,3.7,1.7,4.7,1.3c0.1-1,0.6-1.7,1-2.1c-3.6-0.4-7.3-1.8-7.3-7.9c0-1.7,0.6-3.2,1.6-4.3  c-0.2-0.4-0.7-2,0.2-4.2c0,0,1.3-0.4,4.4,1.6c1.3-0.4,2.6-0.5,4-0.5c1.4,0,2.7,0.2,4,0.5C23.1,6.6,24.4,7,24.4,7  c0.9,2.2,0.3,3.8,0.2,4.2c1,1.1,1.6,2.5,1.6,4.3c0,6.1-3.7,7.5-7.3,7.9c0.6,0.5,1.1,1.5,1.1,3c0,2.1,0,3.9,0,4.4  c0,0.4,0.3,0.9,1.1,0.8C27.4,29.5,32,23.5,32,16.4C32,7.6,24.8,0.4,16,0.4z"></path></svg></a></div> <div mdui-tab class="mdui-tab mdui-tab-centered mdui-color-indigo"><a href="/" class="mdui-ripple">Home</a> </div></div> <div mdui-fab="{trigger: 'hover'}" class="mdui-fab-wrapper"><a href="#" class="mdui-fab mdui-ripple mdui-color-red"><i class="mdui-icon material-icons"></i> <i class="mdui-icon material-icons mdui-fab-opened"></i></a> <div class="mdui-fab-dial"><a href="/" class="mdui-fab mdui-fab-mini mdui-ripple mdui-color-indigo"><i class="mdui-icon material-icons"></i></a></div></div> <div class="mdui-container"><div class="mdui-typo mb-post-content"><div class="content__default"><p>看到各位神仙已经写的够详细了，我也来写写我的见解吧。</p> <h1 id="多项式"><a href="#多项式" aria-hidden="true" class="header-anchor">#</a> 多项式</h1> <h2 id="多项式是什么"><a href="#多项式是什么" aria-hidden="true" class="header-anchor">#</a> 多项式是什么</h2> <p>关于多项式，我们已经在小学一年级的时候已经认识了，所以就不多说了。</p> <h2 id="多项式的表示方法"><a href="#多项式的表示方法" aria-hidden="true" class="header-anchor">#</a> 多项式的表示方法</h2> <h3 id="多项式的系数表示法"><a href="#多项式的系数表示法" aria-hidden="true" class="header-anchor">#</a> 多项式的系数表示法</h3> <p>设 $f_i$ 表示 $n$ 次多项式$F(x)$ $i$ 次项的系数，则</p> <p>$$F(x)=\sum_{i=0}^nf_ix^i$$</p> <h3 id="点值表示法"><a href="#点值表示法" aria-hidden="true" class="header-anchor">#</a> 点值表示法</h3> <p>我们在小学二年级的时候学过，一个 $n$ 次多项式 $F(x)$ 可以由 $n+1$ 个不同的点 $(x_i,F(x_i))$ 确定。如果不明白的话没关系，这不重要。</p> <h1 id="多项式的乘法"><a href="#多项式的乘法" aria-hidden="true" class="header-anchor">#</a> 多项式的乘法</h1> <p>关于多项式的乘法，我们已经在小学二年级学过了。我也就不多说了。</p> <p>很明显，系数表示法下朴素算法的时间复杂度是 $\Theta(nm)$，会被卡。</p> <p>那点值表示法呢？看上去只要每个点和对应的点乘一乘就好了，复杂度 $\Theta(nm)$，但从系数表示法转换成点值表示法是 $\Theta(nm)$ 的。</p> <p>怎么优化呢？这就用到我们的 $\text{FFT}&amp;\text{NTT}$了。</p> <h1 id="fft"><a href="#fft" aria-hidden="true" class="header-anchor">#</a> FFT</h1> <p>在学习 FFT 之前，我们先来复习一下我们小学三年级学的<strong>复数</strong>和<strong>单位根</strong></p> <h2 id="复数"><a href="#复数" aria-hidden="true" class="header-anchor">#</a> 复数</h2> <h3 id="复数的概念"><a href="#复数的概念" aria-hidden="true" class="header-anchor">#</a> 复数的概念</h3> <blockquote><p>我们把形如 $z=a+bi$（$a,b$ 均为实数）的数称为<code>复数</code>，其中 $a$ 称为实部，$b$ 称为<code>虚部</code>，$i$ 称为<code>虚数单位</code>。 ——百度百科</p></blockquote> <p>我觉得这已经讲得够详细了，我就不补充了。</p> <h3 id="复数的运算"><a href="#复数的运算" aria-hidden="true" class="header-anchor">#</a> 复数的运算</h3> <ul><li>复数的加法：$(a+bi)+(c+di)=(a+c)+(b+d)i$</li> <li>复数的减法：同理</li> <li>复数的乘法：$(a+bi)(c+di)=ac+adi+bci-bd=(ac-bd)+(ad+bc)i$</li></ul> <p>此外，复数相乘在极坐标中的几何意义是：<strong>模长相乘，幅角相加</strong>。</p> <h2 id="单位根"><a href="#单位根" aria-hidden="true" class="header-anchor">#</a> 单位根</h2> <h3 id="单位根的定义"><a href="#单位根的定义" aria-hidden="true" class="header-anchor">#</a> 单位根的定义</h3> <blockquote><p>数学上，$n$ 次单位根是 $n$ 次幂为 $1$ 的复数。它们位于复平面的单位圆上，构成正 $n$ 边形的顶点，其中一个顶点是 $1$。$n$次单位根的模为 $1$  ——百度百科</p></blockquote> <p>$n$ 次单位根共有 $n$ 个，它们是：</p> <p>$$\cos\frac{2k\pi}{n}+i\sin\frac{2k\pi}{n}$$</p> <p>其中 $k$ 是整数且 $1\leq k \leq n$。</p> <p>配合图片理解（$n=8$ 的情况）：</p> <p><img src="https://i.loli.net/2020/02/21/l2tg6HQANhu8ydq.png" alt=""></p> <p>我们把 $\cos\frac{2\pi}{n}+i\sin\frac{2\pi}{n}$ 记为 $\omega_n$（如图中的 $D$表示的复数，我们就把它记作 $\omega_8$）。</p> <p>显然，$\omega_n^k=\cos\frac{2k\pi}{n}+i\sin\frac{2k\pi}{n}$</p> <h3 id="单位根的性质："><a href="#单位根的性质：" aria-hidden="true" class="header-anchor">#</a> 单位根的性质：</h3> <ol><li>$\omega_n^0=1$<br>
显然。</li> <li>$\omega_n^n=1$<br>
证明：$\omega_n^n=\omega_n^k=\cos\frac{2n\pi}{n}+i\sin\frac{2n\pi}{n}=\cos 2\pi+\sin 2\pi=1+0=1$</li> <li>$\omega_{2n}^{2k}=\omega_n^k$<br>
证明：$\omega_{2n}^{2k}=\cos\frac{4k\pi}{2n}+i\sin\frac{4k\pi}{2n}=\cos\frac{2k\pi}{n}+i\sin\frac{2k\pi}{n}=\omega_n^k$</li> <li>$\omega_{n}^{\frac{n}{2}}=-1$<br>
证明：$\omega_{n}^{\frac{n}{2}}=\cos\frac{n\pi}{n}+i\sin\frac{n\pi}{n}=\cos\pi+i\sin\pi=-1$</li></ol> <h2 id="快速傅里叶变换（fft）"><a href="#快速傅里叶变换（fft）" aria-hidden="true" class="header-anchor">#</a> 快速傅里叶变换（FFT）</h2> <p>上面讲了一大堆什么单位根，有什么用呢？没错！我们要把它们带入多项式里去。</p> <p>前面说过，一个 $n$ 次多项式 $F(x)$ 可以由 $n+1$ 个不同的点 $(x_i,F(x_i))$ 确定。<strong>我们这里令$n$为 $F(x)$ 的次数 $+1$。</strong></p> <p>但显然，仅仅是简单的带入和朴素算法没区别。但利用单位根的性质，我们可以使用<strong>分治</strong>进行优化。</p> <p>不妨把一个多项式 $F(x)$ 按照奇偶性分成两组：</p> <p>$$\begin{aligned}F(x)&amp;=f_0x^0+f_1x^1+f_2x^2+\dots\&amp;=(f_0x^0+f_2x^2+f_4x^4+\dots)+(f_1x^1+f_3x^3+f_5x^5+\dots)\&amp;=(f_0x^0+f_2x^2+f_4x^4+\dots)+x(f_1x^0+f_3x^2+f_5x^4+\dots)\end{aligned}$$</p> <p>我们令 $L(x)=f_0x^0+f_2x^1+f_3x^2+\dots$，$R(x)=f_1x^0+f_3x^1+f_5x^2+\dots$</p> <p>显然，$F(x)=L(x^2)+xR(x^2)$。</p> <p>然后我们带入 $\omega_n^k$。
，得到</p> <p>$$\begin{aligned}F(\omega_n^k)&amp;=L(\omega_n^{2k})+\omega_n^kR(\omega_n^{2k})\&amp;=L(\omega_\frac{n}{2}^k)+\omega_n^kR(\omega_\frac{n}{2}^k)\end{aligned}$$</p> <p>然后我们发现，$L(x)$ 和 $R(x)$ 的 $x$ 取值范围是 $\omega_\frac{n}{2}^0\sim\omega_\frac{n}{2}^{\frac{n}{2}-1}$，但这里的 $k$ 取值范围是 $0\sim n-1$，明显超过了。但别忘了，$\omega_{n}^{\frac{n}{2}}=-1$。我们把 $\omega_n^{k+\frac{n}{2}}$带入。</p> <p>$$\begin{aligned}F(\omega_n^{k+\frac{n}{2}})&amp;=L(\omega_n^{2k+n})+\omega_n^{k+\frac{n}{2}}R(\omega_n^{2k+n})\&amp;=L(\omega_\frac{n}{2}^k)-\omega_n^kR(\omega_\frac{n}{2}^k)\end{aligned}$$</p> <p>于是我们在计算 $F(\omega_n^k)$ 的时候同时计算 $F(\omega_n^{k+\frac{n}{2}})$。</p> <h2 id="快速傅里叶逆变换"><a href="#快速傅里叶逆变换" aria-hidden="true" class="header-anchor">#</a> 快速傅里叶逆变换</h2> <p>转换成点至表示法运算完之后还需要重新转换成系数表示法。</p> <p>设 $g_i=F(\omega_n^i)$，$G(x)=\sum_{i=0}^ng_ix^i$</p> <p>看似无从下手呢。</p> <p><s>于是我们可以考虑上网搜题解。</s></p> <p><s>网上的题解显示</s>先带一个 $\omega_n^{-k}$ 。<s>然后直觉告诉我们这是对的。</s></p> <p>$$\begin{aligned}G(\omega_n^{-k})&amp;=\sum_{i=0}^{n-1}g_i\omega_n^{-ki}\&amp;=\sum_{i=0}^{n-1}(\sum_{j=0}^{n-1}f_j\omega_n^{ij})\omega_n^{-ki}\&amp;=\sum_{i=0}^{n-1}\sum_{j=0}^{n-1}f_j\omega_n^{ij}\omega_n^{-ki}\&amp;=\sum_{j=0}^{n-1}f_j\sum_{i=0}^{n-1}\omega_n^{(j-k)i}\end{aligned}$$</p> <p>我们先对 $\sum_{i=0}\limits^{n-1}\omega_n^{(j-k)i}$ 这个式子下手。</p> <p>分两种情况讨论：</p> <ol><li>当 $j=k$ 时，显然这个式子的结果是 $n$。</li> <li>当 $j\neq k$ 时，我们就用到了我们的等比数列求和大法。先看这个等式：
$$\sum_{i=0}^{n-1}\omega_n^{(j-k)i}=\sum_{i=0}^{n-1}\omega_n^{(j-k)i}$$
它显然成立。我们在这个等式两边同时乘上 $\omega_n^{j-k}$，得到：
$$\omega_n^{j-k}\sum_{i=0}^{n-1}\omega_n^{(j-k)i}=\sum_{i=0}^{n-1}\omega_n^{(j-k)(i+1)}$$
两等式相减，得
$$(\omega_{n-1}^{j-k}-1)\sum_{i=0}^{n-1}\omega_n^{(j-k)i}=1-\omega_n^{n}$$
想想单位根的某个性质。
$$\begin{aligned}&amp;\ \ \ \ \ \ (\omega_{n-1}^{j-k}-1)\sum_{i=0}^{n-1}\omega_n^{(j-k)i}&amp;=&amp;0\&amp;\Rightarrow\sum_{i=0}^{n-1}\omega_n^{(j-k)i}&amp;=&amp;0\end{aligned}$$</li></ol> <p>回到原式。我们发现，当 $j=k$ 时，$\sum_{i=0}\limits^{n-1}\omega_n^{(j-k)i}=n$，且这种情况只有一次出现，其余情况 $\sum_{i=0}\limits^{n-1}\omega_n^{(j-k)i}$ 均等于 $0$。</p> <p>所以，
$$\begin{aligned}&amp;\ \ \ \ \ \ G(\omega_n^{-k})&amp;=&amp;\sum_{j=0}^{n-1}f_j\sum_{i=0}^{n-1}\omega_n^{(j-k)i}\&amp;&amp;=&amp;nf_k\&amp;\Rightarrow f_k&amp;=&amp;\frac{G(\omega_n^{-k})}{n}\end{aligned}$$</p> <hr> <p>好了，FFT的理论部分就讲到这里。</p> <h1 id="ntt"><a href="#ntt" aria-hidden="true" class="header-anchor">#</a> NTT</h1> <h1 id="铭谢"><a href="#铭谢" aria-hidden="true" class="header-anchor">#</a> 铭谢</h1> <ul><li>感谢@attack 神仙的题解。这篇题解和那篇题解的思路是基本一样的，所以会有很多相似的地方。</li></ul></div> <div class="mdui-text-right mdui-typo-caption-opacity"><i class="mdui-icon material-icons"></i> 学习笔记</div> <div class="mdui-text-right mdui-typo-caption-opacity"><i class="mdui-icon material-icons"></i> 2020-02-21T11:29:36.000Z</div> <!----> <hr> <div id="mb-comments-container"><div id="mb-comments"></div></div></div></div> <div class="mdui-bottom-nav mdui-color-indigo mdui-bottom-nav-scroll-hide"> <a mdui-tooltip="{content: 'Powered by vuepress', position: 'top'}" class="mdui-ripple mdui-bottom-nav-active"><i class="mdui-icon material-icons"></i> <label>Info</label></a></div> <script type="text/javascript">
		mdui.mutation();
	</script> <script>
		(function(){
			var bp = document.createElement('script');
			var curProtocol = window.location.protocol.split(':')[0];
			if (curProtocol === 'https') {
				bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
			}else {
				bp.src = 'http://push.zhanzhang.baidu.com/push.js';
			}
			var s = document.getElementsByTagName('script')[0];
			if(window.location.hostname=='bambusoideae.cn')s.parentNode.insertBefore(bp, s);
		})();
	</script></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.2b333f8b.js" defer></script><script src="/assets/js/4.45ca7a6b.js" defer></script><script src="/assets/js/13.2225d7d0.js" defer></script>
  </body>
</html>
